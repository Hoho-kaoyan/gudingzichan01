# 功能模块详细说明

本文档详细说明固定资产管理系统的各个功能模块及其实现。

## 1. 认证模块 (auth.py)

### 功能说明
负责用户身份验证和权限管理。

### 核心功能
- **EHR号验证**：检查输入的EHR号是否存在，如果存在则返回用户名
- **用户登录**：使用EHR号和密码进行登录，返回JWT token
- **Token验证**：验证JWT token并获取当前用户信息
- **权限控制**：区分管理员和普通用户的权限

### 实现细节
- 使用JWT（JSON Web Token）进行无状态认证
- 密码使用bcrypt加密存储
- Token有效期30天
- 支持基于角色的访问控制（RBAC）

### API接口
- `POST /api/auth/check-ehr` - 检查EHR号
- `POST /api/auth/login` - 用户登录

## 2. 用户管理模块 (users.py)

### 功能说明
管理系统中所有用户的信息，包括管理员和普通用户。

### 核心功能
- **用户列表**：查看所有用户（仅管理员）
- **用户详情**：查看指定用户的详细信息
- **创建用户**：添加新用户（仅管理员）
- **更新用户**：修改用户信息（仅管理员）
- **删除用户**：删除用户（仅管理员）
- **批量导入**：通过Excel文件批量导入用户（仅管理员）

### 数据模型
- EHR号（7位数字，唯一标识）
- 真实姓名
- 组别（如：第1组、管理组）
- 角色（admin/user）
- 密码（加密存储）

### Excel导入格式
| EHR号 | 姓名 | 组别 | 角色 | 密码 |
|-------|------|------|------|------|
| 1234567 | 张三 | 第1组 | user | 123456 |

### API接口
- `GET /api/users/` - 获取用户列表
- `GET /api/users/me` - 获取当前用户信息
- `GET /api/users/{id}` - 获取指定用户
- `POST /api/users/` - 创建用户
- `PUT /api/users/{id}` - 更新用户
- `DELETE /api/users/{id}` - 删除用户
- `POST /api/users/import` - 批量导入用户

## 3. 资产管理模块 (assets.py)

### 功能说明
管理所有固定资产的信息，包括实物情况和盘点情况。

### 核心功能
- **资产列表**：查看所有资产，支持筛选（资产编号、大类、状态、使用人）
- **资产详情**：查看指定资产的详细信息
- **创建资产**：添加新资产
- **更新资产**：修改资产信息
- **删除资产**：删除资产
- **批量导入**：通过Excel文件批量导入资产

### 数据模型

#### 实物情况
- 资产编号（唯一）
- 所属大类（关联AssetCategory）
- 实物名称
- 规格型号（可选）
- 状态（在用/库存备用）
- MAC地址（可选）
- IP地址（可选）

#### 盘点情况
- 存放办公地点
- 存放楼层
- 使用人（关联User）
- 使用人组别

### Excel导入格式
| 资产编号 | 所属大类 | 实物名称 | 规格型号 | 状态 | MAC地址 | IP地址 | 存放办公地点 | 存放楼层 | 使用人EHR号 | 使用人组别 |
|---------|---------|---------|---------|------|---------|--------|------------|---------|------------|-----------|
| ASSET001 | 电子设备配件 | 主机 | i7-9700 | 在用 | 00:11:22:33:44:55 | 192.168.1.100 | 办公楼A | 3楼 | 1234567 | 第1组 |

### API接口
- `GET /api/assets/` - 获取资产列表（支持筛选）
- `GET /api/assets/{id}` - 获取指定资产
- `POST /api/assets/` - 创建资产
- `PUT /api/assets/{id}` - 更新资产
- `DELETE /api/assets/{id}` - 删除资产
- `POST /api/assets/import` - 批量导入资产

## 4. 资产交接模块 (transfers.py)

### 功能说明
处理资产从A员工转移到B员工的申请流程。

### 核心功能
- **申请交接**：提交资产交接申请
- **查看申请**：查看交接申请列表和详情
- **权限控制**：普通用户只能查看自己相关的申请

### 业务流程
1. 用户选择要交接的资产
2. 选择转入用户
3. 填写交接原因（可选）
4. 提交申请，状态为"pending"
5. 管理员审批
6. 如果批准，资产的使用人更新为转入用户

### 数据模型
- 资产ID（关联Asset）
- 转出用户ID（关联User）
- 转入用户ID（关联User）
- 交接原因
- 审批状态（pending/approved/rejected）
- 审批人ID（关联User）
- 审批意见
- 审批时间

### API接口
- `GET /api/transfers/` - 获取交接申请列表
- `GET /api/transfers/{id}` - 获取指定交接申请
- `POST /api/transfers/` - 创建交接申请

## 5. 资产退回模块 (returns.py)

### 功能说明
处理资产退回仓库的申请流程，通常用于员工离职时。

### 核心功能
- **申请退回**：提交资产退回仓库申请
- **查看申请**：查看退回申请列表和详情
- **权限控制**：普通用户只能查看自己的申请

### 业务流程
1. 用户选择要退回的资产
2. 填写退回原因（可选）
3. 提交申请，状态为"pending"
4. 管理员审批
5. 如果批准：
   - 资产的使用人清空
   - 资产状态变为"库存备用"
   - 清空存放地点和楼层信息

### 数据模型
- 资产ID（关联Asset）
- 退回用户ID（关联User）
- 退回原因
- 审批状态（pending/approved/rejected）
- 审批人ID（关联User）
- 审批意见
- 审批时间

### API接口
- `GET /api/returns/` - 获取退回申请列表
- `GET /api/returns/{id}` - 获取指定退回申请
- `POST /api/returns/` - 创建退回申请

## 6. 审批管理模块 (approvals.py)

### 功能说明
管理员审批资产交接和退回申请。

### 核心功能
- **审批交接申请**：批准或拒绝资产交接申请
- **审批退回申请**：批准或拒绝资产退回申请
- **自动更新资产**：批准后自动更新资产信息

### 审批流程
1. 管理员查看待审批的申请列表
2. 选择批准或拒绝
3. 填写审批意见（可选）
4. 提交审批
5. 系统自动更新资产信息（如果批准）

### 审批结果处理

#### 批准交接
- 资产的使用人更新为转入用户
- 自动更新使用人组别

#### 批准退回
- 资产的使用人清空
- 资产状态变为"库存备用"
- 清空存放地点和楼层信息

#### 拒绝
- 申请状态更新为"rejected"
- 资产信息不变

### API接口
- `POST /api/approvals/approve` - 审批申请

## 7. 资产大类模块 (categories.py)

### 功能说明
管理资产的分类，如办公用品、电子设备配件等。

### 核心功能
- **大类列表**：查看所有资产大类
- **创建大类**：添加新的资产大类

### 数据模型
- 大类名称（唯一）

### API接口
- `GET /api/categories/` - 获取资产大类列表
- `POST /api/categories/` - 创建资产大类

## 前端页面说明

### 1. 登录页面 (Login.jsx)
- 输入EHR号后自动验证并显示用户名
- 输入密码完成登录
- 使用JWT token进行后续请求认证

### 2. 首页 (Dashboard.jsx)
- 显示系统统计信息
- 资产总数、在用资产、用户总数、待审批数量

### 3. 用户管理页面 (UserManagement.jsx)
- 用户列表展示
- 新增、编辑、删除用户
- Excel批量导入功能

### 4. 资产管理页面 (AssetManagement.jsx)
- 资产列表展示（支持筛选）
- 新增、编辑、删除资产
- Excel批量导入功能

### 5. 资产交接页面 (TransferManagement.jsx)
- 交接申请列表
- 提交新的交接申请
- 查看申请状态

### 6. 资产退回页面 (ReturnManagement.jsx)
- 退回申请列表
- 提交新的退回申请
- 查看申请状态

### 7. 审批管理页面 (ApprovalManagement.jsx)
- 待审批申请列表（交接和退回）
- 审批操作（批准/拒绝）
- 填写审批意见

## 权限控制

### 管理员权限
- 查看所有用户和资产
- 管理用户（增删改查、批量导入）
- 审批所有申请
- 管理资产大类

### 普通用户权限
- 查看自己的资产
- 提交资产交接和退回申请
- 查看自己相关的申请状态
- 查看资产大类列表

## 数据流转

### 资产交接流程
```
用户A → 提交交接申请 → 管理员审批 → 批准 → 资产转移到用户B
```

### 资产退回流程
```
用户 → 提交退回申请 → 管理员审批 → 批准 → 资产退回仓库
```

## 技术实现要点

### 后端
- 使用FastAPI的依赖注入实现权限控制
- 使用SQLAlchemy ORM进行数据库操作
- 使用Pydantic进行数据验证
- 使用JWT进行无状态认证

### 前端
- 使用React Context管理全局状态（认证信息）
- 使用React Router进行路由管理
- 使用Ant Design提供UI组件
- 使用Axios进行HTTP请求，自动添加token

### 数据库
- SQLite数据库（可替换为PostgreSQL/MySQL）
- 使用SQLAlchemy进行ORM映射
- 自动创建数据库表结构

## 扩展建议

1. **数据导出**：添加Excel导出功能
2. **资产盘点**：定期盘点功能
3. **资产维修**：维修记录管理
4. **报表统计**：各类统计报表
5. **消息通知**：审批结果通知
6. **操作日志**：记录所有操作历史
7. **多级审批**：支持多级审批流程




