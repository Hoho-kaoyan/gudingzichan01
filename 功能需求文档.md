# 固定资产管理系统 - 功能需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| **文档名称** | 固定资产管理系统功能需求文档 |
| **文档版本** | 1.0 |
| **编写日期** | 2025年 |
| **编写人员** | 系统开发团队 |
| **审核状态** | 待审核 |

---

## 1. 项目概述

### 1.1 项目背景

固定资产管理系统是一个基于Web的企业级资产管理系统，旨在帮助企业或组织高效管理固定资产，包括资产的登记、分配、交接、退回、审批等全生命周期管理。

### 1.2 项目目标

1. **提高资产管理效率**：通过数字化管理，减少人工操作，提高资产管理的准确性和效率
2. **规范资产流转流程**：建立标准化的资产交接、退回流程，确保资产流转的可追溯性
3. **实现权限分级管理**：区分管理员和普通用户权限，确保系统安全性
4. **完整记录资产历史**：记录资产的所有操作历史，便于审计和追溯
5. **支持批量操作**：支持Excel批量导入用户和资产，提高数据录入效率

### 1.3 系统定位

- **系统类型**：Web应用系统
- **部署方式**：前后端分离架构
- **用户规模**：支持中小型企业或组织（建议用户数：10-500人）
- **数据规模**：支持管理资产数量：100-10000件

### 1.4 技术架构

- **后端**：Python FastAPI + SQLAlchemy + SQLite
- **前端**：React 18 + Ant Design 5 + Vite
- **认证方式**：JWT Token
- **数据存储**：SQLite（可升级为PostgreSQL/MySQL）

---

## 2. 用户角色定义

### 2.1 管理员（Admin）

**角色描述**：系统管理员，拥有系统的最高权限，负责系统的日常管理和维护。

**主要职责**：
- 管理用户账户（创建、编辑、删除、批量导入）
- 管理所有资产信息
- 审批资产交接、退回、编辑申请
- 管理资产大类
- 查看系统统计数据
- 查看所有资产的历史记录

**权限范围**：
- ✅ 查看所有用户和资产
- ✅ 创建、编辑、删除用户
- ✅ 创建、编辑、删除资产（直接操作，无需审批）
- ✅ 批量导入用户和资产
- ✅ 审批所有类型的申请
- ✅ 管理资产大类
- ✅ 查看系统统计数据
- ✅ 查看所有资产的历史记录

### 2.2 普通用户（User）

**角色描述**：系统普通用户，可以管理自己使用的资产，提交资产流转申请。

**主要职责**：
- 查看自己使用的资产
- 提交资产交接申请
- 提交资产退回申请
- 提交资产编辑申请（修改自己名下的资产）
- 查看自己相关的申请状态
- 查看资产历史记录

**权限范围**：
- ✅ 查看自己使用的资产
- ✅ 提交资产交接申请
- ✅ 提交资产退回申请
- ✅ 提交资产编辑申请（只能编辑自己名下的资产）
- ✅ 查看自己相关的申请状态
- ✅ 查看资产历史记录
- ❌ 不能查看其他用户的资产
- ❌ 不能直接编辑资产（需提交申请）
- ❌ 不能修改资产的使用人
- ❌ 不能访问用户管理和审批管理页面

---

## 3. 功能需求

### 3.1 用户认证模块

#### 3.1.1 EHR号验证功能

**功能描述**：用户在登录时输入EHR号，系统自动验证EHR号是否存在。

**功能需求**：
- 用户输入7位数字的EHR号
- 系统实时验证EHR号格式（7位数字）
- 如果EHR号存在，显示对应的用户名
- 如果EHR号不存在，显示错误提示
- 验证过程应在1秒内完成

**输入**：7位数字EHR号

**输出**：
- 成功：显示用户名
- 失败：显示错误提示信息

**业务规则**：
- EHR号必须是7位数字
- EHR号在系统中必须唯一
- 验证失败不影响用户继续输入密码

#### 3.1.2 用户登录功能

**功能描述**：用户使用EHR号和密码登录系统。

**功能需求**：
- 用户输入EHR号和密码
- 系统验证用户身份
- 登录成功后返回JWT Token
- Token有效期30天
- 登录成功后跳转到首页

**输入**：EHR号、密码

**输出**：
- 成功：返回JWT Token，跳转到首页
- 失败：显示错误提示（密码错误、用户不存在等）

**业务规则**：
- 密码使用bcrypt加密存储
- 密码错误3次后建议锁定账户（可选功能）
- Token存储在浏览器localStorage中
- Token过期后需要重新登录

#### 3.1.3 登录状态保持

**功能描述**：系统自动验证Token有效性，保持用户登录状态。

**功能需求**：
- 每次API请求自动携带Token
- Token过期后自动跳转到登录页
- 支持"记住我"功能（可选）

**业务规则**：
- Token有效期30天
- Token过期后需要重新登录
- 未登录用户访问受保护页面时自动跳转到登录页

---

### 3.2 用户管理模块

#### 3.2.1 用户列表查看

**功能描述**：管理员可以查看系统中所有用户的列表。

**功能需求**：
- 显示用户列表，包含：EHR号、姓名、组别、角色、创建时间
- 支持分页显示（每页20条，可调整）
- 支持按组别、角色筛选
- 支持关键词搜索（EHR号、姓名）
- 列表支持排序（按创建时间、姓名等）

**权限要求**：仅管理员可访问

**业务规则**：
- 普通用户无法访问此功能
- 列表只显示未删除的用户

#### 3.2.2 创建用户

**功能描述**：管理员可以创建新用户账户。

**功能需求**：
- 表单包含字段：EHR号、姓名、组别、角色、密码
- EHR号格式验证（7位数字）
- EHR号唯一性验证
- 密码强度验证（建议至少6位）
- 创建成功后显示成功提示

**输入字段**：
- EHR号（必填，7位数字，唯一）
- 姓名（必填）
- 组别（必填，如：第1组、管理组）
- 角色（必填，admin/user）
- 密码（必填，至少6位）

**业务规则**：
- EHR号必须唯一
- 密码使用bcrypt加密存储
- 创建用户后，该用户可立即登录系统

#### 3.2.3 编辑用户信息

**功能描述**：管理员可以编辑用户信息。

**功能需求**：
- 可以修改：姓名、组别、角色、密码
- 不能修改EHR号（唯一标识）
- 修改密码时，新密码需要验证
- 编辑成功后显示成功提示

**业务规则**：
- EHR号不可修改
- 修改密码时，新密码使用bcrypt加密存储
- 修改用户信息不影响该用户的登录状态

#### 3.2.4 删除用户

**功能描述**：管理员可以删除用户账户。

**功能需求**：
- 删除前需要确认
- 删除成功后显示成功提示
- 删除的用户无法再登录系统
- 删除用户时，检查该用户是否有关联资产

**业务规则**：
- 如果用户有关联资产（使用中的资产），建议先处理资产再删除用户
- 删除用户后，该用户的资产使用人信息应清空或转移

#### 3.2.5 批量导入用户

**功能描述**：管理员可以通过Excel文件批量导入用户。

**功能需求**：
- 支持Excel格式（.xlsx, .xls）
- Excel格式验证
- 批量导入时显示进度
- 导入完成后显示结果（成功数量、失败数量、错误详情）
- 错误数据最多显示50条错误信息

**Excel格式要求**：
| 列名 | 必填 | 说明 |
|------|------|------|
| EHR号 | 是 | 7位数字，唯一标识 |
| 姓名 | 是 | 用户真实姓名 |
| 组别 | 是 | 如"第1组""管理组" |
| 角色 | 否 | user（默认）或admin |
| 密码 | 否 | 默认为123456 |

**业务规则**：
- EHR号必须唯一，重复的EHR号会被跳过
- 必填字段缺失时，该行数据会被跳过
- 导入过程中，如果某行数据出错，不影响其他行的导入
- 导入成功后，新用户可立即登录系统

---

### 3.3 资产管理模块

#### 3.3.1 资产列表查看

**功能描述**：用户可以查看资产列表，管理员可查看所有资产，普通用户只能查看自己使用的资产。

**功能需求**：
- 显示资产列表，包含：资产编号、名称、大类、状态、使用人、存放地点等
- 支持分页显示（每页20条，可调整）
- 支持多条件筛选（资产编号、大类、状态、使用人）
- 支持关键词搜索（资产编号、名称、规格型号等）
- 列表支持排序
- 支持调整列宽
- 管理员可以查看所有资产
- 普通用户只能查看自己使用的资产

**权限要求**：
- 管理员：可查看所有资产
- 普通用户：只能查看自己使用的资产

**业务规则**：
- 只显示未删除的资产（软删除）
- 筛选和搜索条件可以组合使用

#### 3.3.2 创建资产

**功能描述**：用户可以创建新资产记录。

**功能需求**：
- 表单包含资产的所有字段
- 资产编号唯一性验证
- 必填字段验证
- 创建成功后显示成功提示
- 自动创建资产流转记录

**输入字段**：

**实物情况（必填）**：
- 资产编号（必填，唯一）
- 所属大类（必填）
- 实物名称（必填）

**实物情况（可选）**：
- 规格型号
- 状态（默认：在用）
- MAC地址
- IP地址

**盘点情况（可选）**：
- 存放办公地点
- 存放楼层
- 座位号
- 使用人（选择用户）
- 使用人组别（自动填充）
- 备注说明

**权限要求**：
- 管理员：可以创建资产
- 普通用户：可以创建资产（使用人默认为自己）

**业务规则**：
- 资产编号必须唯一
- 如果使用人已选择，使用人组别自动填充
- 创建资产时自动创建流转记录（操作类型：create）
- 如果资产大类不存在，系统自动创建

#### 3.3.3 编辑资产信息

**功能描述**：用户可以编辑资产信息，管理员可直接编辑，普通用户需提交申请。

**功能需求**：
- 管理员可以直接编辑资产，修改后立即生效
- 普通用户只能编辑自己名下的资产，且需提交编辑申请，等待管理员审批
- 普通用户不能修改资产的使用人
- 编辑成功后显示成功提示
- 自动创建资产流转记录

**权限要求**：
- 管理员：可以直接编辑所有资产
- 普通用户：只能编辑自己名下的资产，且需提交申请

**业务规则**：
- 管理员编辑资产后立即生效
- 普通用户编辑资产需提交申请，审批通过后生效
- 编辑资产时，只记录有变化的字段
- 资产编号不可修改（唯一标识）

#### 3.3.4 删除资产（软删除）

**功能描述**：管理员可以删除资产，采用软删除机制。

**功能需求**：
- 删除前需要确认
- 删除成功后显示成功提示
- 资产从列表中消失，但数据库中仍保留
- 自动创建资产流转记录

**权限要求**：仅管理员可删除资产

**业务规则**：
- 采用软删除机制，不真正删除数据
- 删除的资产不会在列表中显示
- 删除的资产历史记录仍保留
- 删除操作不可恢复（但数据仍在数据库中）

#### 3.3.5 查看资产详情

**功能描述**：用户可以查看资产的详细信息。

**功能需求**：
- 显示资产的所有字段信息
- 显示资产的使用人信息
- 显示资产所属大类信息
- 可以查看资产流转记录（链接到历史记录页面）

**权限要求**：
- 管理员：可以查看所有资产详情
- 普通用户：只能查看自己使用的资产详情

#### 3.3.6 批量导入资产

**功能描述**：管理员可以通过Excel文件批量导入资产。

**功能需求**：
- 支持Excel格式（.xlsx, .xls）
- Excel格式验证
- 批量导入时显示进度
- 导入完成后显示结果（成功数量、失败数量、错误详情）
- 错误数据最多显示50条错误信息

**Excel格式要求**：

**必填列**：
- 资产编号（唯一）
- 所属大类
- 实物名称

**可选列**：
- 规格型号
- 状态（在用/库存备用，默认：在用）
- MAC地址
- IP地址
- 存放办公地点
- 存放楼层
- 座位号
- 使用人EHR号
- 使用人组别（或"组别"）
- 备注说明

**权限要求**：仅管理员可批量导入资产

**业务规则**：
- 资产编号必须唯一，重复的编号会被跳过
- 如果使用人EHR号存在，自动匹配用户
- 如果使用人组别未提供，自动从用户信息获取
- 如果资产大类不存在，系统自动创建
- 导入过程中，如果某行数据出错，不影响其他行的导入

#### 3.3.7 资产导出功能

**功能描述**：管理员可以导出资产列表为Excel文件。

**功能需求**：
- 支持导出当前筛选条件下的资产
- 导出文件包含所有资产字段
- 导出文件格式与导入格式一致

**权限要求**：仅管理员可导出资产

---

### 3.4 资产交接模块

#### 3.4.1 查看交接申请列表

**功能描述**：用户可以查看资产交接申请列表。

**功能需求**：
- 显示交接申请列表，包含：资产信息、转出人、转入人、状态、创建时间等
- 管理员可以看到所有交接申请
- 普通用户只能看到自己相关的申请（作为转出人或转入人）
- 支持按状态筛选（待审批/已批准/已拒绝）
- 支持关键词搜索（资产编号、资产名称、用户名等）
- 支持分页显示

**权限要求**：
- 管理员：可查看所有交接申请
- 普通用户：只能查看自己相关的申请

#### 3.4.2 提交交接申请

**功能描述**：用户可以提交资产交接申请，将资产从当前使用人转移到其他用户。

**功能需求**：
- 选择要交接的资产（只能选择当前用户使用的资产）
- 选择转入用户
- 填写交接原因（可选）
- 提交成功后显示成功提示
- 申请状态为"待审批"
- 自动创建资产流转记录

**输入字段**：
- 资产（必填，只能选择当前用户使用的资产）
- 转入用户（必填）
- 交接原因（可选）

**权限要求**：所有用户都可以提交交接申请

**业务规则**：
- 只能交接当前用户使用的资产
- 不能将资产交接给自己
- 提交申请后，资产状态不变，等待审批
- 申请提交后，自动创建流转记录（操作类型：transfer）

#### 3.4.3 查看交接申请详情

**功能描述**：用户可以查看交接申请的详细信息。

**功能需求**：
- 显示完整的申请信息
- 显示资产信息
- 显示转出人和转入人信息
- 显示审批状态和审批意见（如果已审批）
- 显示审批人和审批时间（如果已审批）

---

### 3.5 资产退回模块

#### 3.5.1 查看退回申请列表

**功能描述**：用户可以查看资产退回申请列表。

**功能需求**：
- 显示退回申请列表，包含：资产信息、退回人、状态、创建时间等
- 管理员可以看到所有退回申请
- 普通用户只能看到自己的退回申请
- 支持按状态筛选（待审批/已批准/已拒绝）
- 支持关键词搜索
- 支持分页显示

**权限要求**：
- 管理员：可查看所有退回申请
- 普通用户：只能查看自己的退回申请

#### 3.5.2 提交退回申请

**功能描述**：用户可以提交资产退回申请，将资产退回仓库。

**功能需求**：
- 选择要退回的资产（只能选择当前用户使用的资产）
- 填写退回原因（可选）
- 可以修改资产的部分信息（MAC地址、IP地址、存放地点、座位号、备注等）
- 可以选择新的保管人（可选）
- 提交成功后显示成功提示
- 申请状态为"待审批"
- 自动创建资产流转记录

**输入字段**：
- 资产（必填，只能选择当前用户使用的资产）
- 退回原因（可选）
- 修改的资产信息（可选）：
  - MAC地址
  - IP地址
  - 存放办公地点
  - 存放楼层
  - 座位号
  - 新保管人
  - 备注说明

**权限要求**：所有用户都可以提交退回申请

**业务规则**：
- 只能退回当前用户使用的资产
- 提交申请后，资产状态不变，等待审批
- 申请提交后，自动创建流转记录（操作类型：return）

#### 3.5.3 查看退回申请详情

**功能描述**：用户可以查看退回申请的详细信息。

**功能需求**：
- 显示完整的申请信息
- 显示资产信息
- 显示退回人信息
- 显示修改的字段信息（如果有）
- 显示审批状态和审批意见（如果已审批）

---

### 3.6 资产编辑申请模块

#### 3.6.1 查看编辑申请列表

**功能描述**：用户可以查看资产编辑申请列表。

**功能需求**：
- 显示编辑申请列表，包含：资产信息、申请人、状态、创建时间等
- 管理员可以看到所有编辑申请
- 普通用户只能看到自己的编辑申请
- 支持按状态筛选（待审批/已批准/已拒绝）
- 支持关键词搜索（资产编号、资产名称、用户名等）
- 支持分页显示

**权限要求**：
- 管理员：可查看所有编辑申请
- 普通用户：只能查看自己的编辑申请

#### 3.6.2 提交编辑申请

**功能描述**：普通用户可以提交资产编辑申请，修改资产信息。

**功能需求**：
- 选择要编辑的资产（只能选择自己名下的资产）
- 修改需要编辑的字段（普通用户不能修改使用人）
- 提交成功后显示成功提示
- 申请状态为"待审批"
- 自动创建资产流转记录

**可编辑字段**：
- 实物名称
- 规格型号
- 状态
- MAC地址
- IP地址
- 存放办公地点
- 存放楼层
- 座位号
- 使用人（仅管理员可修改）
- 使用人组别
- 备注说明

**权限要求**：
- 管理员：可以直接编辑资产，无需提交申请
- 普通用户：只能编辑自己名下的资产，且需提交申请

**业务规则**：
- 普通用户只能编辑自己名下的资产
- 普通用户不能修改资产的使用人
- 只记录有变化的字段
- 申请提交后，自动创建流转记录（操作类型：edit）

---

### 3.7 审批管理模块

#### 3.7.1 查看待审批申请列表

**功能描述**：管理员可以查看所有待审批的申请。

**功能需求**：
- 显示所有待审批的申请（交接、退回、编辑）
- 使用标签页分类显示（交接申请、退回申请、编辑申请）
- 列表显示：申请类型、资产信息、申请人、创建时间等
- 支持按申请类型筛选
- 支持关键词搜索
- 支持分页显示

**权限要求**：仅管理员可访问

#### 3.7.2 审批交接申请

**功能描述**：管理员可以审批资产交接申请。

**功能需求**：
- 查看交接申请详情
- 选择批准或拒绝
- 填写审批意见（可选）
- 审批成功后显示成功提示
- 如果批准，自动更新资产信息
- 自动创建资产流转记录

**审批结果处理**：

**批准**：
- 申请状态更新为"已批准"
- 资产的使用人更新为转入用户
- 资产的使用人组别自动更新
- 创建流转记录（操作类型：approve）

**拒绝**：
- 申请状态更新为"已拒绝"
- 资产信息不变
- 创建流转记录（操作类型：approve）

**权限要求**：仅管理员可审批

#### 3.7.3 审批退回申请

**功能描述**：管理员可以审批资产退回申请。

**功能需求**：
- 查看退回申请详情
- 选择批准或拒绝
- 填写审批意见（可选）
- 审批成功后显示成功提示
- 如果批准，自动更新资产信息
- 自动创建资产流转记录

**审批结果处理**：

**批准**：
- 申请状态更新为"已批准"
- 资产的使用人清空（或更新为新保管人，如果申请中有填写）
- 资产状态变为"库存备用"
- 更新存放地点等信息（如果申请中有修改）
- 创建流转记录（操作类型：approve）

**拒绝**：
- 申请状态更新为"已拒绝"
- 资产信息不变
- 创建流转记录（操作类型：approve）

**权限要求**：仅管理员可审批

#### 3.7.4 审批编辑申请

**功能描述**：管理员可以审批资产编辑申请。

**功能需求**：
- 查看编辑申请详情
- 查看修改的字段对比
- 选择批准或拒绝
- 填写审批意见（可选）
- 审批成功后显示成功提示
- 如果批准，自动更新资产信息
- 自动创建资产流转记录

**审批结果处理**：

**批准**：
- 申请状态更新为"已批准"
- 资产的相应字段更新为申请中的值
- 创建流转记录（操作类型：edit_approve）

**拒绝**：
- 申请状态更新为"已拒绝"
- 资产信息不变
- 创建流转记录（操作类型：edit_approve）

**权限要求**：仅管理员可审批

---

### 3.8 资产历史记录模块

#### 3.8.1 查看资产流转记录

**功能描述**：用户可以查看资产的完整流转记录。

**功能需求**：
- 显示资产的所有操作记录
- 记录按时间倒序排列
- 使用时间线形式展示
- 显示操作类型、操作人、操作时间、操作描述
- 显示变更详情（旧值、新值）
- 支持查看记录的详细信息

**操作类型**：
- `create`：创建资产
- `edit`：编辑资产
- `transfer`：资产交接
- `return`：资产退回
- `approve`：审批操作
- `edit_approve`：编辑申请审批
- `delete`：删除资产

**权限要求**：
- 管理员：可以查看所有资产的历史记录
- 普通用户：可以查看自己使用的资产的历史记录

**业务规则**：
- 所有资产操作都会自动创建流转记录
- 记录包含操作前后的值变化
- 记录包含操作人和审批人信息
- 记录不可删除，永久保存

---

### 3.9 资产大类管理模块

#### 3.9.1 查看资产大类列表

**功能描述**：用户可以查看所有资产大类。

**功能需求**：
- 显示所有资产大类列表
- 列表显示大类名称、创建时间
- 支持关键词搜索

**权限要求**：所有用户都可以查看资产大类列表

#### 3.9.2 创建资产大类

**功能描述**：管理员可以创建新的资产大类。

**功能需求**：
- 输入大类名称
- 大类名称唯一性验证
- 创建成功后显示成功提示
- 新大类可以立即在创建资产时使用

**输入字段**：
- 大类名称（必填，唯一）

**权限要求**：仅管理员可创建资产大类

**业务规则**：
- 大类名称必须唯一
- 创建资产时，如果大类不存在，系统自动创建

---

### 3.10 统计看板模块

#### 3.10.1 首页统计展示

**功能描述**：系统首页显示统计数据。

**功能需求**：
- 显示资产总数
- 显示在用资产数
- 显示用户总数
- 显示待审批数量（交接+退回+编辑）
- 统计数据实时更新
- 使用卡片形式展示

**权限要求**：
- 管理员：显示所有统计数据
- 普通用户：可以查看统计数据（可选，根据需求调整）

**业务规则**：
- 统计数据实时计算
- 待审批数量包括所有待审批的申请（交接、退回、编辑）

---

## 4. 非功能需求

### 4.1 性能需求

- **页面加载时间**：首页应在3秒内加载完成
- **API响应时间**：API请求应在1秒内响应
- **并发用户数**：支持至少50个并发用户
- **数据量支持**：支持管理10000条资产记录

### 4.2 安全性需求

- **用户认证**：使用JWT Token进行身份认证
- **密码加密**：密码使用bcrypt加密存储
- **权限控制**：基于角色的访问控制（RBAC）
- **数据验证**：所有输入数据必须验证
- **SQL注入防护**：使用ORM防止SQL注入
- **XSS防护**：前端输入数据转义

### 4.3 可用性需求

- **系统可用性**：系统可用性应达到99%
- **数据备份**：建议定期备份数据库
- **错误处理**：友好的错误提示信息
- **操作确认**：删除等危险操作需要确认

### 4.4 兼容性需求

- **浏览器支持**：Chrome、Firefox、Edge（最新版本）
- **屏幕分辨率**：支持1920x1080及以上分辨率
- **响应式设计**：支持不同屏幕尺寸（可选）

### 4.5 可维护性需求

- **代码规范**：遵循代码规范，便于维护
- **日志记录**：记录系统操作日志
- **文档完整**：提供完整的系统文档

---

## 5. 数据模型

### 5.1 用户表（users）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| ehr_number | String(7) | EHR号 | 唯一，非空 |
| real_name | String(100) | 真实姓名 | 非空 |
| group | String(50) | 组别 | 非空 |
| role | String(20) | 角色 | 非空，默认user |
| password_hash | String(255) | 密码哈希 | 非空 |
| created_at | DateTime | 创建时间 | 自动 |
| updated_at | DateTime | 更新时间 | 自动 |

### 5.2 资产大类表（asset_categories）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| name | String(100) | 大类名称 | 唯一，非空 |
| created_at | DateTime | 创建时间 | 自动 |

### 5.3 资产表（assets）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| asset_number | String(100) | 资产编号 | 唯一，非空 |
| category_id | Integer | 所属大类ID | 外键，非空 |
| name | String(200) | 实物名称 | 非空 |
| specification | String(200) | 规格型号 | 可空 |
| status | String(20) | 状态 | 非空，默认"在用" |
| mac_address | String(50) | MAC地址 | 可空 |
| ip_address | String(50) | IP地址 | 可空 |
| office_location | String(200) | 存放办公地点 | 可空 |
| floor | String(50) | 存放楼层 | 可空 |
| seat_number | String(50) | 座位号 | 可空 |
| user_id | Integer | 使用人ID | 外键，可空 |
| user_group | String(50) | 使用人组别 | 可空 |
| remark | Text | 备注说明 | 可空 |
| created_at | DateTime | 创建时间 | 自动 |
| updated_at | DateTime | 更新时间 | 自动 |
| deleted_at | DateTime | 删除时间 | 可空（软删除） |
| deleted_by_id | Integer | 删除人ID | 外键，可空 |

### 5.4 交接申请表（transfer_requests）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| asset_id | Integer | 资产ID | 外键，非空 |
| from_user_id | Integer | 转出用户ID | 外键，非空 |
| to_user_id | Integer | 转入用户ID | 外键，非空 |
| created_by_id | Integer | 申请创建人ID | 外键，可空 |
| reason | Text | 交接原因 | 可空 |
| status | String(20) | 审批状态 | 非空，默认pending |
| approver_id | Integer | 审批人ID | 外键，可空 |
| approval_comment | Text | 审批意见 | 可空 |
| created_at | DateTime | 创建时间 | 自动 |
| updated_at | DateTime | 更新时间 | 自动 |
| approved_at | DateTime | 审批时间 | 可空 |

### 5.5 退回申请表（return_requests）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| asset_id | Integer | 资产ID | 外键，非空 |
| user_id | Integer | 退回用户ID | 外键，非空 |
| reason | Text | 退回原因 | 可空 |
| status | String(20) | 审批状态 | 非空，默认pending |
| approver_id | Integer | 审批人ID | 外键，可空 |
| approval_comment | Text | 审批意见 | 可空 |
| mac_address | String(50) | 修改的MAC地址 | 可空 |
| ip_address | String(50) | 修改的IP地址 | 可空 |
| office_location | String(200) | 修改的存放地点 | 可空 |
| floor | String(50) | 修改的存放楼层 | 可空 |
| seat_number | String(50) | 修改的座位号 | 可空 |
| new_user_id | Integer | 新保管人ID | 外键，可空 |
| remark | Text | 修改的备注 | 可空 |
| created_at | DateTime | 创建时间 | 自动 |
| updated_at | DateTime | 更新时间 | 自动 |
| approved_at | DateTime | 审批时间 | 可空 |

### 5.6 编辑申请表（asset_edit_requests）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| asset_id | Integer | 资产ID | 外键，非空 |
| user_id | Integer | 申请人ID | 外键，非空 |
| edit_data | Text | 编辑数据（JSON） | 非空 |
| status | String(20) | 审批状态 | 非空，默认pending |
| approver_id | Integer | 审批人ID | 外键，可空 |
| approval_comment | Text | 审批意见 | 可空 |
| created_at | DateTime | 创建时间 | 自动 |
| updated_at | DateTime | 更新时间 | 自动 |
| approved_at | DateTime | 审批时间 | 可空 |

### 5.7 资产历史记录表（asset_history）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | 自增 |
| asset_id | Integer | 资产ID | 外键，非空 |
| action_type | String(50) | 操作类型 | 非空 |
| action_description | Text | 操作描述 | 可空 |
| operator_id | Integer | 操作人ID | 外键，可空 |
| approver_id | Integer | 审批人ID | 外键，可空 |
| old_value | Text | 旧值（JSON） | 可空 |
| new_value | Text | 新值（JSON） | 可空 |
| related_request_id | Integer | 关联申请ID | 可空 |
| related_request_type | String(20) | 关联申请类型 | 可空 |
| created_at | DateTime | 操作时间 | 非空，自动 |

---

## 6. 业务流程

### 6.1 资产交接流程

```
1. 用户A选择要交接的资产
2. 选择转入用户B
3. 填写交接原因（可选）
4. 提交交接申请
5. 系统创建交接申请记录（状态：pending）
6. 系统创建资产流转记录（操作类型：transfer）
7. 管理员查看待审批申请
8. 管理员审批申请
   - 批准：资产使用人更新为B，创建流转记录（操作类型：approve）
   - 拒绝：申请状态更新为rejected，创建流转记录（操作类型：approve）
```

### 6.2 资产退回流程

```
1. 用户选择要退回的资产
2. 填写退回原因（可选）
3. 可以修改资产信息（MAC、IP、存放地点等）
4. 提交退回申请
5. 系统创建退回申请记录（状态：pending）
6. 系统创建资产流转记录（操作类型：return）
7. 管理员查看待审批申请
8. 管理员审批申请
   - 批准：资产使用人清空，状态变为"库存备用"，更新存放地点等，创建流转记录
   - 拒绝：申请状态更新为rejected，创建流转记录
```

### 6.3 资产编辑流程

```
1. 普通用户选择要编辑的资产（只能是自己名下的）
2. 修改需要编辑的字段（不能修改使用人）
3. 提交编辑申请
4. 系统创建编辑申请记录（状态：pending）
5. 系统创建资产流转记录（操作类型：edit）
6. 管理员查看待审批申请
7. 管理员审批申请
   - 批准：资产信息更新，创建流转记录（操作类型：edit_approve）
   - 拒绝：申请状态更新为rejected，创建流转记录（操作类型：edit_approve）
```

### 6.4 管理员直接编辑流程

```
1. 管理员选择要编辑的资产
2. 修改资产信息
3. 保存
4. 资产信息立即更新
5. 系统创建资产流转记录（操作类型：edit）
```

---

## 7. 接口需求

### 7.1 认证接口

- `POST /api/auth/check-ehr` - 检查EHR号是否存在
- `POST /api/auth/login` - 用户登录

### 7.2 用户管理接口

- `GET /api/users/` - 获取用户列表（管理员）
- `GET /api/users/me` - 获取当前用户信息
- `GET /api/users/{id}` - 获取指定用户
- `POST /api/users/` - 创建用户（管理员）
- `PUT /api/users/{id}` - 更新用户（管理员）
- `DELETE /api/users/{id}` - 删除用户（管理员）
- `POST /api/users/import` - 批量导入用户（管理员）

### 7.3 资产管理接口

- `GET /api/assets/` - 获取资产列表（支持筛选和搜索）
- `GET /api/assets/{id}` - 获取指定资产
- `POST /api/assets/` - 创建资产
- `PUT /api/assets/{id}` - 更新资产
- `DELETE /api/assets/{id}` - 删除资产（软删除）
- `POST /api/assets/import` - 批量导入资产（仅管理员）
- `GET /api/assets/export` - 导出资产（仅管理员）

### 7.4 资产交接接口

- `GET /api/transfers/` - 获取交接申请列表
- `GET /api/transfers/{id}` - 获取指定交接申请
- `POST /api/transfers/` - 创建交接申请

### 7.5 资产退回接口

- `GET /api/returns/` - 获取退回申请列表
- `GET /api/returns/{id}` - 获取指定退回申请
- `POST /api/returns/` - 创建退回申请

### 7.6 资产编辑申请接口

- `GET /api/edit-requests/` - 获取编辑申请列表
- `GET /api/edit-requests/{id}` - 获取指定编辑申请
- `POST /api/edit-requests/` - 创建编辑申请

### 7.7 审批接口

- `POST /api/approvals/approve` - 审批申请（管理员）

### 7.8 资产历史记录接口

- `GET /api/asset-history/asset/{asset_id}` - 获取指定资产的流转记录

### 7.9 资产大类接口

- `GET /api/categories/` - 获取资产大类列表
- `POST /api/categories/` - 创建资产大类

### 7.10 统计接口

- `GET /api/stats/` - 获取系统统计数据

---

## 8. 权限控制矩阵

| 功能模块 | 管理员 | 普通用户 |
|---------|--------|---------|
| 查看所有用户 | ✅ | ❌ |
| 创建/编辑/删除用户 | ✅ | ❌ |
| 批量导入用户 | ✅ | ❌ |
| 查看所有资产 | ✅ | ❌ |
| 查看自己的资产 | ✅ | ✅ |
| 创建资产 | ✅ | ✅ |
| 直接编辑资产 | ✅ | ❌ |
| 提交编辑申请 | ❌ | ✅ |
| 删除资产 | ✅ | ❌ |
| 批量导入资产 | ✅ | ❌ |
| 导出资产 | ✅ | ❌ |
| 提交交接申请 | ✅ | ✅ |
| 提交退回申请 | ✅ | ✅ |
| 查看所有申请 | ✅ | ❌ |
| 查看自己的申请 | ✅ | ✅ |
| 审批申请 | ✅ | ❌ |
| 查看所有资产历史 | ✅ | ❌ |
| 查看自己的资产历史 | ✅ | ✅ |
| 创建资产大类 | ✅ | ❌ |
| 查看统计数据 | ✅ | ✅（可选） |

---

## 9. 异常处理需求

### 9.1 网络异常

- 网络断开时，显示友好的错误提示
- 支持重试操作
- 不会导致页面崩溃

### 9.2 数据验证异常

- 输入数据格式错误时，显示具体的错误提示
- 必填项缺失时，高亮显示
- 唯一性冲突时，显示明确的错误信息

### 9.3 权限异常

- 无权限访问时，显示"无权限"提示
- 自动跳转到有权限的页面

### 9.4 系统异常

- 系统错误时，显示友好的错误提示
- 记录错误日志，便于排查问题

---

## 10. 扩展需求（未来版本）

### 10.1 数据导出功能

- 支持导出资产列表为Excel
- 支持导出用户列表为Excel
- 支持导出申请列表为Excel

### 10.2 资产盘点功能

- 定期资产盘点
- 盘点结果记录
- 盘点差异处理

### 10.3 资产维修功能

- 维修记录管理
- 维修申请流程
- 维修历史记录

### 10.4 报表统计功能

- 资产统计报表
- 用户资产报表
- 资产流转报表
- 审批统计报表

### 10.5 消息通知功能

- 审批结果通知
- 申请状态变更通知
- 系统消息推送

### 10.6 多级审批功能

- 支持多级审批流程
- 审批流程配置
- 审批人指定

### 10.7 资产标签功能

- 支持给资产打标签
- 按标签筛选资产
- 标签管理

### 10.8 资产照片功能

- 支持上传资产照片
- 照片管理
- 照片查看

---

## 11. 验收标准

### 11.1 功能验收

- ✅ 所有功能模块按需求文档实现
- ✅ 所有业务流程正常运行
- ✅ 权限控制正确实现
- ✅ 数据验证正确实现

### 11.2 性能验收

- ✅ 页面加载时间符合要求
- ✅ API响应时间符合要求
- ✅ 支持预期的并发用户数

### 11.3 安全验收

- ✅ 用户认证安全可靠
- ✅ 权限控制正确
- ✅ 数据安全存储
- ✅ 无SQL注入、XSS等安全漏洞

### 11.4 兼容性验收

- ✅ 支持主流浏览器
- ✅ 界面显示正常
- ✅ 功能正常运行

---

## 12. 附录

### 12.1 术语表

| 术语 | 说明 |
|------|------|
| EHR号 | 员工健康记录号，7位数字，用户唯一标识 |
| 资产编号 | 资产的唯一标识符 |
| 资产大类 | 资产的分类，如办公用品、电子设备配件 |
| 软删除 | 不真正删除数据，只是标记为已删除 |
| 流转记录 | 资产的所有操作历史记录 |
| JWT Token | JSON Web Token，用于用户认证 |

### 12.2 参考文档

- [README.md](README.md) - 项目说明文档
- [QUICKSTART.md](QUICKSTART.md) - 快速启动指南
- [IMPORT_GUIDE.md](IMPORT_GUIDE.md) - 批量导入教程
- [FEATURES.md](FEATURES.md) - 功能模块详细说明
- [功能测试文档.md](功能测试文档.md) - 功能测试文档

---

**文档版本：** 1.0  
**最后更新：** 2025年  
**文档状态：** 正式版

